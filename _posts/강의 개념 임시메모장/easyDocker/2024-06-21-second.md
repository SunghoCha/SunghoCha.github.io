PART1. 가상화 기술

<가상화 기술과 하이퍼바이저 가상화>



가상이란 실제로 존재하지 않지만 마치 존재하는 것처럼 느껴지는 것을 의미한다.

이를 대입해보면 가상화 기술은 컴퓨터에서 사용되는 기술로서 실제로 존재하는 컴퓨터는 아니지만 마치 실제로 존재하는 것처럼 만들어주는 기술을 의미한다.

가상화 기술을 사용하면 하나의 컴퓨터만 가지고 마치 여러 대를 가진 것처럼 사용할 수 있음

정리하자면 컴퓨터 안에서 컴퓨터를 또 실행하는 기술이라고 이해할수도 있음

IT에서는 실제로 존재하는 것을 물리적, 가상으로 존재하는 것을 논리적으로 존재한다라고 표현하는 점을 고려하면 

가상화 기술은 물리적인 컴퓨팅 환경 내부에서 논리적인 컴퓨팅 환경을 만들 수 있는 기술이라고 정의할 수 있다.

이를 활용하여 한대의 컴퓨터에 여러 대의 논리적인 OS환경을 만들 수 있으며 이렇게 만들어진 가상환경에 사용자가 리소스를 직접 분배할 수 있음

리소스를 분배한다는 것은 하나의 가상 OS가 사용할 수 있는 리소스의 최대값을 정해놓는다는 의미이며 그만큼 총 리소스 사용량은 증가할 수 있으나 논리적으로 격리되어 있어 하나의  OS를 사용할때 발생하는 문제에 따라 연쇄적으로 다른 프로그램들이 영향을 받는 것을 방지할 수 있는 이점이 있음

그런데 그냥 하드웨어를 여러대 사용하지 않고 굳이 복잡하게 가상화 기술을 사용하는  이유는 뭘까

하드웨어의 성능은 빠르게 발전하고 있으며 동시에 하드웨어를 사용하는 소프트웨어의 크기는 상대적으로 감소하는 추세.

기업 입장에서는 낮은 사양의 컴퓨터를 여러대 운용하는 것보다 높은 사양의 컴퓨터를 한 대 사용하는 것이 가격, 공간,운영 등의 측면에서 훨씬 경제적임

이러한 이유들로 가상화 기술을 사용하여 하나의 하드웨어를 효율적으로 활용하는 것이 엔터프라이즈 환경에서는 필수적

"하이퍼바이저"와 "컨테이너"가 하나의 큰 서버를 여러 개의 논리적인 작은 서버로 쪼개서 사용하는 가상화 기술을 사용한 방식

하이퍼바이저 가상화는 전통적인 가상화 기술로서 컴퓨터에 설치되는 프로그램으로, OS의 프로그램으로 실행해서 가상화 환경을 관리할 수 있다. 가상OS를 만들거나 실행하고 종료할 수 있으며 사용자가 지정해 놓은 CPU나 메모리만큼 컴퓨터의 격리된 공간을 만들 수 있다. 가상환경은 실행되지 않은 상태일때는 일반적인 프로그램과 마찬가지로  저장용량만 차지하고 있다가 실행되면 CPU와 메모리를 사용하게 된다.

좀 더 기술적인 용어로 말하면 먼저 물리적인 서버에 설치되는 OS는 호스트 OS라고 부른다.

호스트OS에는 하이퍼바이저를 설치해서 가상환경을 만들 수 있다.
하이퍼바이저는 호스트 OS의 자원을 격리해서 새로운 OS를 실행한다. 이렇게 설치돼서 실행된 OS를 게스트OS라고 부른다. 호스트 OS는 물리적인 하드웨어와 직접 연결되어 있으며 게스트OS는 호스트 OS의 리소스를 나눈 논리적인 공간이다. 가상 머신에서 웹서버, WAS, DB같은 프로그램을 프로세스로 실행해서 운영하게 된다. 

정리하자면 엔터프라이즈 운영환경에서는 서버에 호스트OS를 설치하고 가상화를 사용하기 위해 하이퍼바이저를 설치한 다음 가상머신을 만들어서 게스트OS를 실행한다.그 후 게스트 OS에서 실제 실행을 원하는 프로세스를 운영한다.



하이퍼바이저의 간단한 동작원리

프로세스는 정상적으로 실행되기 위해서  CPU나 메모리 같은 리소스를 사용해야 하며 하드웨어를 사용하기 위해서는 OS를 통해서만 가능하다.
OS에는 하드웨어를 사용하기 위한 커널이 설치되어 있으며 프로세스는 하드웨어 리소스 사용을 요청하기 위해 커널의 시스템 콜을 이용하게 된다. 
시스템콜은 하드웨어에 사용 요청을 프로세스 대신 전달해주는 메커니즘으로서 하드웨어의 자원 사용을 가능하게 한다.

OS에는 대표적으로 윈도우, 리눅스, 맥OS가 있으며 각각의 OS는 다른 종류의 커널을 사용하고 그에 따라 시스템콜 또한 다르다.
그렇다면 가상화 기술을 사용할 때 호스트OS와 게스트OS가 다른 상황에선 어떻게 동작하는 것일까?

예를 들어 윈도우 호스트OS에서 게스트OS로 맥OS나 리눅스OS를 실행해야하는 상황을 가정해보자.
게스트OS의 커널은 실제로 물리적인 하드웨어가 없기 때문에 리소스를 사용하려면 호스트OS의 커널로 리소스 사용을 요청해야 한다.

하지만 호스트OS와 게스트OS의 종류가 다르므로 호스트OS는 게스트OS에서 전달받은 시스템콜을 처리할 수 없게 된다.
여기서 하이퍼바이저가 바로 다른 커널 간의 언어를 통혁해주는 통역가 역할을 수행한다.
그래서 하이퍼바이저를 사용하면 격리된 공간을 만들면서 호스트OS와 다른 종류의 게스트OS도 사용할 수 있게 된다.

하이퍼바이저를 사용하는 많은 케이스가 윈도우OS에서 리눅스OS를 사용하는 경우인데, 이유는 윈도우OS는 사용성은 뛰어나지만 한대의 성능이 무겁고 라이선스 가격도 비싸기 때문이다. 그래서 메인OS는 윈도우로 유지하면서 실제로 프로그램을 실행시키는 서버 운영은 가벼운 리눅스OS로 하는 경우가 많다.









