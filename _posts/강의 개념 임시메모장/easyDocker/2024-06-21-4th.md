PART1. 가상화 기술

<컨테이너 기술과 도커>

컨테이너에서 도커란?

커널이 자체적으로 제공하는 가상화 기술은 사용자가 직접 컨트롤하긴 어렵다.

도커는 커널의 컨테이너 가상화 기술을 편리하게 사용하기 위해 만들어진 소프트웨어이며 사용자는 도커를 이용해서 컨테이너를 만들고 운영할 수 있다.

하이퍼바이저 방식에서는 격리된 공간을 만드는 소프트웨어가 하이퍼바이저라는 소프트웨어였지만 컨테이너 가상화에서는 실제 격리를 수행하는 주체가

커널 자체이다. 도커는 커널의 가상화 기술을 활용할 수 있게 도와주는 보조 도구.

도커와 같은 컨테이너 가상화 도구를 컨테이너 플랫폼이라고 부른다. 이 플랫폼은 자체적으로 가지고 있는 컨테이너 엔진과 컨테이너 런타임으로 구성되어 있다.

컨테이너 엔진은 사용자의 요청을 받아서 컨테이너를 관리해주는 역할을 하고 컨테이너 런타임은 직접 커널과 통신하면서 실제로 격리된 공간을 만드는 역할을 수행한다. 

컨테이너 런타임은 OCI라는 곳에서 규정한 컨테이너 런타임 인터페이스인 CRI표준을 구현한 것이며 도커는 이를 구현한 RUNC라는 컨테이너 런타임을 기본으로 지원한다.



--

도커는 클라이언트-서버 모델로 실행된다.

사용자의 명령을 전달해주는 클라이언트와 실제로 컨테이너를 관리해주는 도커 데몬이라는 서버가 존재한다.
클라이언트는 사용자의 명령을 도커 데몬에게 전달하며 도커 데몬(도커D라고도 불리며  "데몬"은  서버에서 지속적으로 실행되는 소프트웨어를 의미)은 지속적으로 실행되면서 컨테이너를 관리하는 기능을 제공해준다.
이 관리는 도커데몬이 호스트OS의 커널 기능을 활용해서 이루어지며 이를 API 제공을 통해서 클라이언트가 사용할 수 있도록 한다.

API는 상호간의 주고받는 데이터의 약속된 양식을 의미하므로 도커 데몬 또한 API 명세서를 제공한다.
그러나 사용자가  각각의 필요한 작업마다 API 명세서 상세정보를 전부 파악하고 작업하는 것은 번거롭기 때문에  Docker에서는
Command Line 도구인 Docker CLI(Command Line Interface)가 클라이언트 툴로 제공된다.
CLI는 클라이언트가 명령어를 입력하면 이를 서버의 API 양식에 맞게 만들어서 대신 전달해주므로 사용자는 도커 데몬의  API와 쉽게 통신할 수 있게 된다.

예를 들어 CLI에서 컨테이너의 목록을 조회하기 위해선 $ docker ps라는 명령어 한 줄만 입력하면 다음과 같은 과정이 수행된다.

1. 명령어 실행 ($ docker ps)
2. 사용자 명령을 API에 맞추어 변환
3. 데몬에 API 요청
4. 데몬이 요청을 분석하여 커널을 통해 컨테이너 리스트를 불러오고 이를 JSON 형태로 응답을 만들어서 전달
5. CLI는 전달받은 응답을 사용자가 보기 편한 테이블 형태로 만들어서 화면에 표시



정리하자면, 도커는 클라이언트 서버 모델로 실행되며 클라이언트는 CLI, 서버는 도커 데몬으로 구성된다.

사용자는 CLI를 통해서 간단한 명령어를 사용해서 컨테이너를 관리할 수 있다.

명령어를 실행하면 CLI는 API에 맞게 요청을 만들어서 도커 데몬으로 전달한다.

데몬은 컨테이너 런타임을 통해서 컨테이너를 조작하고 그 결과를 JSON형태로 CLI로 다시 전달한다.





